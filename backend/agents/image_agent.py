from langchain_core.messages import AIMessage
from .workflow import AgentState, llm, SystemMessage

async def image_agent_node(state: AgentState) -> AgentState:
    """Handle image generation requests."""
    messages = state["messages"]
    
    system_prompt = """–¢—ã –∞–≥–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ Jarvis.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫.

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ —Ä–µ–∂–∏–º–µ MVP.
–°–æ–æ–±—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
"üñºÔ∏è –Ø –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é: [–æ–ø–∏—Å–∞–Ω–∏–µ].
–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è."
"""
    
    response = await llm.ainvoke([
        SystemMessage(content=system_prompt),
        *messages
    ])
    
    return {
        **state,
        "messages": [response]
    }
